<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>迪巧 - 百洋健康搜索</title>
    <link rel="stylesheet" href="../font/iconfont.css">
    <link rel="stylesheet" href="../header/head.css">
    <link rel="stylesheet" href="../foot/foot.css">
    <link rel="stylesheet" href="../side column/celan.css">
    <link rel="stylesheet" href="../css/list.css">
</head>

<body>
    <script src="../header/head.js"></script>
    <div id="list-wrapper">
        <div class="content">
            <i class="iconfont iconhome"></i>
            <span>首页</span>
            <i class="iconfont iconarrow-right"></i>
            <span>微量元素</span>
        </div>
    </div>
    <div id="list-nav">
        <div class="content">
            <div class="list-nav-right">
                <span>排序方式:</span>
                <span class="nav-active">默认</span>
                <span>
                    销量
                    <i class="iconfont iconxia"></i>
                </span>
                <span>
                    人气
                    <i class="iconfont iconxia"></i>
                </span>
                <span id="paixu">
                    价格
                    <i class="iconfont iconxia1"></i>
                </span>
            </div>
            <ul>
                <em></em>
                <li>
                    <i></i>
                    平台自营
                </li>
                <li>
                    <i></i>
                    赠品
                </li>
                <li>
                    <i></i>
                    100%正品保证
                </li>
                <li>
                    <i></i>
                    30天无忧售后
                </li>
                <li>
                    <i></i>
                    7天无忧售后
                </li>
                <li>
                    <i></i>
                    跨境商品
                </li>
                <li>
                    <i></i>
                    日药品
                </li>
                <li>
                    <i></i>
                    正品保障
                </li>
            </ul>
            <div id="select">
                <select name="" id="">
                    <option value="">请选择</option>
                    <option value="">一般贸易</option>
                    <option value="">保税备货</option>
                    <option value="">跨境直邮</option>
                </select>
            </div>
            <div class="nav-loca">
                <span>商品所在地</span>
                <select name="" id="">
                    <option value="">不限地区</option>
                </select>
            </div>
            <div class="nav-tab">
                <span class="tab-prve">上一页</span>
                <span class="tab-next">下一页</span>
            </div>
        </div>
    </div>
    <div id="goodlist">
        <div class="content">
            <ul id="list" class="tx">
                <!-- <li>
                    <div class="list">
                        <div class="list-img">
                            <img src="https://shopncstaticimage.baiyangwang.com/shop/store/goods/2/2_05877383026609268.jpg!gthumb"
                                alt="">
                        </div>
                        <div class="list-bottom">
                            <div class="list-imgs">
                                <span>
                                    <img src="https://shopncstaticimage.baiyangwang.com/shop/store/goods/2/2_05877383026609268.jpg!gthumb"
                                        alt="">
                                </span>
                                <span>
                                    <img src="https://shopncstaticimage.baiyangwang.com/shop/store/goods/2/2_05877383026609268.jpg!gthumb"
                                        alt="">
                                </span>
                                <span>
                                    <img src="https://shopncstaticimage.baiyangwang.com/shop/store/goods/2/2_05877383026609268.jpg!gthumb"
                                        alt="">
                                </span>
                            </div>
                            <p>【添加K2助钙成骨 助力宝宝身高UP】D-cal迪巧 小儿碳酸钙颗粒剂升级版 20袋/盒 包邮包税</p>
                            <p class="list-price tx">
                                <span>￥99.00</span>
                                <span>￥119.00</span>
                                <span>
                                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/05890672784766467_60.gif"
                                        alt="">
                                </span>
                                <span>
                                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/05890672577896183_60.gif"
                                        alt="">
                                </span>
                                <span>
                                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/jswl_60.gif" alt="">
                                </span>
                            </p>
                            <p>
                                <span>
                                    <em></em>
                                    加入对比
                                </span>
                            </p>
                            <div class="sell-stat">
                                <span>
                                    1578
                                    <p>商品销量</p>
                                </span>
                                <span>
                                    2016
                                    <p>用户评论</p>
                                </span>
                                <span></span>
                            </div>
                            <div class="list-store">
                                百洋健康跨境自营店
                            </div>
                            <div class="list-car">
                                <i class="iconfont icongouwuchekong"></i>
                                加入购物车
                            </div>
                        </div>
                    </div>
                </li> -->
            </ul>
        </div>
    </div>
    <div id="tab">
        <div class="content">
            <ul class="tx">
                <li>
                    <span class="tab-one">首页</span>
                </li>
                <li>
                    <span class="tab-prve">上一页</span>
                </li>
                <li class="tab-num">
                    <!-- <span>1</span> -->
                </li>
                <li>
                    <span class="tab-next">下一页</span>
                </li>
                <li>
                    <span class="tab-last">末页</span>
                </li>
            </ul>
        </div>
    </div>
    <script src="../foot/foot.js"></script>
    <script src="../side column/celan.js"></script>
</body>
<script src="../js/jquery-1.10.1.min.js"></script>
<script src="../js/com.js"></script>
<script src="../header/headjs.js"></script>
<script src="../side column/celanjs.js"></script>
<script>
    (() => {
        //跳跃登入注册页
        $('#login').click(() => {//登录 
            window.open('login.html');
            if (getcookie('url')) {
                removecookie('url');
                setcookie('url', window.location.href, 0);
            } else {
                console.log(window.location.href);
                setcookie('url', window.location.href, 0);
            }
        })

        $('#zhuce').click(() => {//注册
            window.open('zhuce.html');
        })
        //退出删除
        $('#tuichu').click(function () {
            removecookie('username');
            window.open('login.html');
        })
        //模糊搜索
        let val = decodeURI(location.search.slice(1));
        $('.input-right').blur(function () {
            val = $('.input-right').val();
        })
        //查询
        $('.input-btn').click(function () {
            let p = ` <p>${val}</p>`;
            $('.chaxun-tx').append(p);
            init();
        })
        //渲染列表页
        let ipage = 1;
        let num = 23;
        let ipaixu = 'asc';
        init();
        function init() {
            console.log(val);
            var p = new Promise(function (resolve) {
                $.ajax({
                    type: 'get',
                    url: '../api/liebiao/list.php',
                    dataType: 'json',
                    data: {
                        val,
                        ipage,
                        num,
                        paixu: ipaixu
                    },
                    success: str => {
                        resolve(str);
                    }
                });
            })
            p.then(function (data) {
                let html = data.json.map(item => {//渲染商品
                    let imgs = item.imgs.map(item => {//小图
                        return `<span>
                                <img src="${item.img}"
                                    alt="">
                            </span>`
                    }).join('');
                    return `<li data-id="${item.id}">
                    <div class="list">
                        <div class="list-img">
                            <img src="${item.img}"
                                alt="">
                        </div>
                        <div class="list-bottom">
                            <div class="list-imgs">
                             ${imgs};
                            </div>
                            <p>${item.name}</p>
                            <p class="list-price tx">
                                <span>￥${item.price}</span>
                                <span>￥119.00</span>
                                <span>
                                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/05890672784766467_60.gif"
                                        alt="">
                                </span>
                                <span>
                                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/05890672577896183_60.gif"
                                        alt="">
                                </span>
                                <span>
                                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/jswl_60.gif" alt="">
                                </span>
                            </p>
                            <p>
                                <span>
                                    <em></em>
                                    加入对比
                                </span>
                            </p>
                            <div class="sell-stat">
                                <span>
                                    1578
                                    <p>商品销量</p>
                                </span>
                                <span>
                                    2016
                                    <p>用户评论</p>
                                </span>
                                <span></span>
                            </div>
                            <div class="list-store">
                                百洋健康跨境自营店
                            </div>
                            <div class="list-car">
                                <i class="iconfont icongouwuchekong"></i>
                                加入购物车
                            </div>
                        </div>
                    </div>
                </li>`
                }).join('');
                $('#list').html(html);

                //选项卡分页
                function tabColor() {
                    if (ipage == 1) {
                        $('.tab-prve').css('color', '#AAA');
                        $('.tab-one').css('color', '#AAA');
                    } else {
                        $('.tab-prve').css('color', '#555');
                        $('.tab-one').css('color', '#555');
                    }
                    if (ipage == numipg) {
                        $('.tab-next').css('color', '#AAA');
                        $('.tab-last').css('color', '#AAA');
                    } else {
                        $('.tab-next').css('color', '#555');
                        $('.tab-last').css('color', '#555');
                    }
                }
                let sum = data.sum;
                let numipg = Math.ceil(sum / num);
                let btnsum = '';
                for (let i = 0; i < numipg; i++) {//渲染分页
                    btnsum += `<span>${i + 1}</span>`;
                }
                $('.tab-num').html(btnsum);
                $('.tab-num span').eq(ipage - 1).attr('class', 'tab-active');
                $('.tab-num').on('click', 'span', function () {
                    ipage = $(this).html();
                    init();
                    tabColor();
                })
                //上一页
                $('.tab-prve').off('click').on('click', function () {
                    if (ipage > 1) {
                        ipage--;
                        init();
                    }
                    tabColor();
                })
                //下一页
                $('.tab-next').off('click').on('click', function () {
                    if (ipage < numipg) {
                        ipage++;
                        init();
                    }
                    tabColor();
                })
                //首页
                $('.tab-one').on('click', function () {
                    ipage = 1;
                    tabColor();
                    init();
                })
                //末页
                $('.tab-last').on('click', function () {
                    ipage = numipg;
                    tabColor();
                    init();
                })
                //排序的按钮高亮
                $('.list-nav-right').off('click').on('click', 'span', function () {//点击
                    $(this).attr('class', 'nav-active').siblings().attr('class', '');
                    if ($(this).attr('id') == 'paixu') {//用来价格排序
                        if (ipaixu == 'asc') {
                            ipage = 1;
                            ipaixu = 'desc';
                            $(this).find('i').attr('class', 'iconfont iconxia');
                            tabColor();
                        } else {
                            ipage = 1;
                            ipaixu = 'asc';
                            $(this).find('i').attr('class', 'iconfont iconxia1');
                            tabColor();
                        }
                        init();
                    }
                })
                //小图切换大图
                $('#list li').mouseenter(function () {
                    let index = $(this).index();
                    $(this).find('.list-imgs span').mouseenter(function () {
                        $(this).css('border', '1px solid #EF3C79').siblings().css('border', '1px solid #F0F0F0');
                        $('.list-img').eq(index).children(0).attr('src', $(this).children(0).attr('src'));
                    })
                })
            })
        }
        //吸顶菜单
        let top = $('#list-nav').offset().top;
        $(window).on('scroll', function () {
            if (scrollY >= top) {
                $('#list-nav').css({
                    position: 'fixed',
                    top: '0',
                    left: '57%',
                    zIndex: '100'
                })
                $('.nav-left').css({
                    position: 'fixed',
                    top: '0',
                    left: '252px',
                    zIndex: '100'
                })
            } else {
                $('#list-nav').css({
                    position: 'absolute',
                    top: '240px',
                    left: '50%',
                    zIndex: '1'
                })
                $('.nav-left').css({
                    position: 'relative',
                    top: '0',
                    left: '0',
                    zIndex: '5'
                })
            }
        })
        //跳转详情页
        $('#list').on('click', 'li', function () {
            let id = $(this).attr('data-id');
            let cookie = getcookie('username');
            $.ajax({
                type: 'get',
                url: '../api/footprint/foot.php',
                data: {
                    id,
                    cookie
                }
            });
            window.open('details.html?' + id);
        })
        //足迹
        let cookie = getcookie('username');
        $.ajax({
            type: 'get',
            url: '../api/footprint/foot.php',
            data: {
                cookie
            },
            dataType: 'json',
            success: str => {
                let html = str.map(item => {
                    return `<div><img src="${item.img}" alt=""></div>`
                }).join('');
                $('.my-zuji-list').html(html);
            }
        })
        //小购物车
        creatcarr();
        function creatcarr() {
            $.ajax({
                type: 'get',
                url: '../api/shoppingcar/car.php',
                data: {
                    cookie
                },
                dataType: 'json',
                success: str => {
                    //购物车商品个数
                    $('.numcar').html(str.obj.length);
                    //小购物车
                    let meyall = 0;
                    let html = str.obj.map(item => {
                        meyall += item.num * item.price * 1;
                        return `<li data-id="${item.id}">
                <div>
                    <img src="${item.img}" alt="">
                </div>
                <p>${item.name}</p>
                <p><span>¥${item.price}</span>×<span>${item.num}</span></p>
                <p class="headdel">删除</p>
            </li>`
                    }).join('');
                    //渲染总数量以及总价格 
                    $('.car-list').html(html);
                    $('.headnumall').html(str.obj.length);
                    $('.headmeyall').html('￥' + meyall.toFixed(2));
                    //跳转购物车
                    $('.car-foot div').click(function () {
                        window.open('../html/gwc.html');
                    })
                    //删除商品
                    $('.headdel').click(function () {
                        let id = $(this.parentNode).attr('data-id');
                        console.log(id);
                        $.ajax({
                            type: 'get',
                            url: '../api/shoppingcar/del.php',
                            data: {
                                id,
                            },
                            success: str => {
                                creatcarr();
                            }
                        })
                    })
                }

            })
        }
        //侧栏跳转购物车
        $('.side-car').click(function () {
            window.open('../html/gwc.html');
        })
    })();
</script>

</html>